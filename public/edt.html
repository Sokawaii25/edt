</!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Emploi du temps</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
</head>
<body>
    <div id="app" class="container">
        <div class="row justify-content-center align-items-center">
            <div class="col-2 d-flex" style="justify-content: right;">
                <button class="btn btn-info" @click="changeDate(-1)">Précédent</button>
            </div>
            <div class="col-6 text-center">
                <h1>Emploi du temps</h1>
                <h2> {{ currentDateString }} </h2>
            </div>
            <div class="col-2">
                <button class="btn btn-info" @click="changeDate(1)">Suivant</button>
            </div>
        </div>
        <div class="row justify-content-center">
            <div class="col-6 pb-2" :class="{'bg-light': cours.length > 0}">
                <div class="alert alert-info text-center" role="alert" v-if="cours.length == 0">
                    <h3>Aucun cours ce jour-ci</h3>
                </div>
                <div class="card md-flex mt-2" v-for="unCours in cours" :style="{'background-color': this.couleursMatieres[unCours.matiere.id]}">
                    <div class="card-body">
                        <h5 class="card-title">{{ unCours.dateHeureDebut.heure + ' - ' + unCours.dateHeureFin.heure }}</h5>
                        <div class="row card-text justify-content-between">
                            <div class="col-5">
                                <h6 class="card-subtitle mb-2 text-muted">{{ unCours.matiere.titre + ' - ' + unCours.type }}</h6>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col">
                                <h6 class="card-subtitle text-muted">M.{{ unCours.professeur.nom }}</h6>
                            </div>
                            <div class="col-5 d-flex justify-content-right">
                                <h6 class="card-subtitle text-muted">Salle {{ unCours.salle.numero }}</h6>
                            </div>
                        </div>  
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script type='application/javascript' src='https://unpkg.com/vue@3'></script>
    <script type='application/javascript' src='https://unpkg.com/axios'></script>
    <script type="application/javascript">
        const app = Vue.createApp({
            data() {
                return {
                    apiBase: 'http://127.0.0.1:8000/api',
                    currentDate: new Date(),
                    cours: [],
                    couleursMatieres: [],
                    joursSemaine: ['Dimanche', 'Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi']
                }
            },
            computed: {
                currentDateString: function() {
                    return this.joursSemaine[this.currentDate.getUTCDay()] +' '+(this.currentDate.getDate() < 10 ? '0' : '') + this.currentDate.getDate() + '/' + (this.currentDate.getMonth() < 9 ? '0' : '') + (this.currentDate.getMonth()+1) + '/' + this.currentDate.getFullYear();
                }
            },
            methods: {
                getCours() {
                    axios.get(this.apiBase + '/cours/date/' + this.currentDate.getFullYear() + '-' + (this.currentDate.getMonth()+1) + '-' + this.currentDate.getDate())
                        .then(response => {
                            this.cours = response.data;
                            this.createCouleursMatieres();
                            this.cours.sort(this.compareCours);
                        })
                        .catch(error => {
                            console.log(error)
                        });
                },
                createCouleursMatieres() {
                    this.cours.forEach( unCours => {
                        if(this.couleursMatieres.indexOf(unCours.matiere.id) == -1){
                            this.couleursMatieres[unCours.matiere.id] = "rgb(" + (Math.floor((256-190)*Math.random()) + 200) + "," +
                            (Math.floor((256-190)*Math.random()) + 200) + "," +
                            (Math.floor((256-190)*Math.random()) + 200) + ")";
                        }
                    });
                },
                changeDate(diff) {
                    let temp = new Date(this.currentDate);
                    temp.setDate(temp.getDate() + diff);
                    this.currentDate = temp;
                    this.getCours();
                },
                compareCours(cours1, cours2) {
                    var heureCours1 = cours1.dateHeureDebut.heure.split(':'); 
                    var minutesCours1 = (+heureCours1[0]) * 60 + (+heureCours1[1]);
                    var heureCours2 = cours2.dateHeureDebut.heure.split(':'); 
                    var minutesCours2 = (+heureCours2[0]) * 60 + (+heureCours2[1]);

                    if(minutesCours1 < minutesCours2) {
                        return -1;
                    }
                    
                    if(minutesCours1 > minutesCours2) {
                        return 1;
                    }
                    
                    return 0;
                }
            },
            mounted() {
                this.getCours();
            }
        }).mount('#app');
    </script>
</body>
</html>